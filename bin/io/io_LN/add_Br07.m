%% Import data from text file
% Script for importing data from the following text file:
%
%    filename: C:\Users\andrigun\Dropbox\01-Projects\ICE-GAWS-Processing\data\vatnajokull\vatnajokull_breidamerkurjokull_Br07\L0\2019\BreBr7-19t.dat
%
% Auto-generated by MATLAB on 10-Nov-2022 13:08:01

%% Set up the Import Options and import the data
%% Br07 2019
opts = delimitedTextImportOptions("NumVariables", 21);

% Specify range and delimiter
opts.DataLines = [1, Inf];
opts.Delimiter = " ";

% Specify column names and types
opts.VariableNames = ["decimalday", "year", "doy", "time", "t", "t2", "rh", "rh2", "sw_in", "sw_out", "f", "f1", "d", "HS", "VarName15", "VarName16", "VarName17", "VarName18", "VarName19", "VarName20", "VarName21"];
opts.VariableTypes = ["double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double"];

% Specify file level properties
opts.ExtraColumnsRule = "ignore";
opts.EmptyLineRule = "read";
opts.ConsecutiveDelimitersRule = "join";
opts.LeadingDelimitersRule = "ignore";

% Specify variable properties
opts = setvaropts(opts, "decimalday", "TrimNonNumeric", true);
opts = setvaropts(opts, "decimalday", "ThousandsSeparator", ",");

% Import the data
tdata = readtable("C:\Users\andrigun\Dropbox\01-Projects\ICE-GAWS-Processing\data\vatnajokull\vatnajokull_breidamerkurjokull_Br07\L0\2019\BreBr7-19t.dat", opts);


    % Clear temporary variables
    clear opts
        a = num2str(tdata.time);
        a = strrep(string(a),'   0','2400');
        a = strrep(string(a),'  10','0010');
        a = strrep(string(a),'  20','0020');
        a = strrep(string(a),'  30','0030');
        a = strrep(string(a),'  40','0040');
        a = strrep(string(a),'  50','0050');

        a = char(a);
        HH = str2num(a(:,1:2));
        MM = str2num(a(:,3:4));
        t = datetime(tdata.year,1,tdata.doy,(HH),(MM),0);

        B = table2timetable(tdata,'RowTimes',t);
        B = removevars(B, {'decimalday','year','doy','time'});
        B = removevars(B, {'VarName15','VarName16','VarName17','VarName18','VarName19','VarName20','VarName21'});

        uqy = unique(B.Time.Year);

        sitename = ['ICE-GAWS_Br07_L1_',num2str(uqy),'.csv'];
        fname = ['C:\Users\andrigun\Dropbox\01-Projects\ICE-GAWS-Processing\data\vatnajokull\vatnajokull_breidamerkurjokull_Br07\L1\',sitename];
        writetimetable(B,fname,'Delimiter',',');

%% Br07 2020
opts = delimitedTextImportOptions("NumVariables", 21);

% Specify range and delimiter
opts.DataLines = [1, Inf];
opts.Delimiter = " ";

% Specify column names and types
opts.VariableNames = ["decimalday", "year", "doy", "time", "t", "t2", "rh", "rh2", "sw_in", "sw_out", "f", "f1", "d", "HS", "VarName15", "VarName16", "VarName17", "VarName18", "VarName19", "VarName20", "VarName21"];
opts.VariableTypes = ["double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double"];

% Specify file level properties
opts.ExtraColumnsRule = "ignore";
opts.EmptyLineRule = "read";
opts.ConsecutiveDelimitersRule = "join";
opts.LeadingDelimitersRule = "ignore";

% Specify variable properties
opts = setvaropts(opts, "decimalday", "TrimNonNumeric", true);
opts = setvaropts(opts, "decimalday", "ThousandsSeparator", ",");

% Import the data
tdata = readtable("C:\Users\andrigun\Dropbox\01-Projects\ICE-GAWS-Processing\data\vatnajokull\vatnajokull_breidamerkurjokull_Br07\L0\2020\BreBr7-20t.dat", opts);


    % Clear temporary variables
    clear opts
        a = num2str(tdata.time);
        a = strrep(string(a),'   0','2400');
        a = strrep(string(a),'  10','0010');
        a = strrep(string(a),'  20','0020');
        a = strrep(string(a),'  30','0030');
        a = strrep(string(a),'  40','0040');
        a = strrep(string(a),'  50','0050');

        a = char(a);
        HH = str2num(a(:,1:2));
        MM = str2num(a(:,3:4));
        t = datetime(tdata.year,1,tdata.doy,(HH),(MM),0);

        B = table2timetable(tdata,'RowTimes',t);
        B = removevars(B, {'decimalday','year','doy','time'});
        B = removevars(B, {'VarName15','VarName16','VarName17','VarName18','VarName19','VarName20','VarName21'});

        uqy = unique(B.Time.Year);

        sitename = ['ICE-GAWS_Br07_L1_',num2str(uqy),'.csv'];
        fname = ['C:\Users\andrigun\Dropbox\01-Projects\ICE-GAWS-Processing\data\vatnajokull\vatnajokull_breidamerkurjokull_Br07\L1\',sitename];
        writetimetable(B,fname,'Delimiter',',');

%% 2023
datetime.setDefaultFormats('default','yyyy-MM-dd HH:mm:ss');

opts = delimitedTextImportOptions("NumVariables", 20);

% Specify range and delimiter
opts.DataLines = [1, Inf];
opts.Delimiter = ",";

% Specify column names and types
opts.VariableNames = ["timi", "year", "day", "hhmm", "t", "t2", "rh", "rh2", "sw_in", "sw_out", "f", "f2", "d", "HS", "q1", "HS2", "q2", "tbox", "volt", "albedo"];
opts.VariableTypes = ["double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double", "double"];

% Specify file level properties
opts.ExtraColumnsRule = "ignore";
opts.EmptyLineRule = "read";

% Specify variable properties
opts = setvaropts(opts, ["timi", "year", "day", "hhmm", "t", "t2", "rh", "rh2", "sw_in", "sw_out", "f", "f2", "d", "HS", "q1", "HS2", "q2", "tbox", "volt", "albedo"], "ThousandsSeparator", ",");

% Import the data
tdata = readtable("C:\Users\andrigun\Dropbox\01-Projects\ICE-GAWS-Data\data\vatnajokull\vatnajokull_breidamerkurjokull_Br07\L0\2023\BreBr7-23t.dat", opts);
tdata(1,:) = [];

t = datetime(tdata.timi + datenum('2022/12/31'),'convertFrom','datenum');

t = dateshift(t, 'start', 'minute', 'nearest');

B = table2timetable(tdata,'RowTimes',t);
B = removevars(B, ["timi","year","day","hhmm"]);
B = removevars(B, ["q1","q2","tbox","volt","albedo"]);

uqy = unique(B.Time.Year);

sitename = ['ICE-GAWS_Br07_L1_',num2str(uqy),'.csv'];
fname = ['C:\Users\andrigun\Dropbox\01-Projects\ICE-GAWS-Data\data\vatnajokull\vatnajokull_breidamerkurjokull_Br07\L1\',sitename];
writetimetable(B,fname,'Delimiter',',');
